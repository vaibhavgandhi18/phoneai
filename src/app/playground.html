<div>
  <div class="prose dark:text-white-light">
    <h3 class="m-0 font-bold dark:text-white-light">Breezy Playground</h3>
  </div>
  <ul class="flex space-x-2 rtl:space-x-reverse">
    <li>
      <a href="javascript:;" routerLink="/" class="text-primary hover:underline"
        >Dashboard</a
      >
    </li>
    <li class="before:content-['/'] ltr:before:mr-2 rtl:before:ml-2">
      <span>Breezy Playground</span>
    </li>
  </ul>
  <audio #callerTune>
    <source src="../assets/caller_tune.wav" type="audio/wav" />
  </audio>
  <audio #callLog>
    <source src="../assets/callLog.wav" type="audio/wav" />
  </audio>
  <div class="flex justify-between gap-3 pt-5">
    <div *ngIf="callStatus == ''" class="panel flex basis-1/2 flex-col p-0">
      <div class="border-b p-3 text-center text-lg font-semibold">Breezy</div>
      <div class="p-3">
        <label class="text-base">User Agent AI prompt: </label>
        <div *ngIf="userAgentInitiateCall" class="text-sm">{{userPrompt}}</div>
        <textarea
          id="ctnTextarea"
          [(ngModel)]="userPrompt"
          rows="5"
          class="form-textarea"
          placeholder="Enter prompt for User Agent"
          required
          *ngIf="!userAgentInitiateCall"
        ></textarea>

        <button
          type="submit"
          class="btn btn-primary !mt-6"
          (click)="userAgentPost(callerTune,callLog)"
          *ngIf="!userAgentInitiateCall"
        >
          Submit
        </button>
      </div>
    </div>
    <div
      class="panel flex basis-1/3 flex-col items-center justify-center gap-1 rounded-3xl"
      *ngIf="callStatus != ''"
    >
      <div *ngIf="callStatus == 'outgoing'" class="text-sm text-gray-600">
        Outgoing call
      </div>
      <div class="text-center text-lg font-semibold">Breezy</div>
      <div
        class="mt-2 flex h-24 w-24 items-center justify-center rounded-full border border-gray-100"
      >
        <div
          class="flex h-20 w-20 items-center justify-center rounded-full border border-gray-200"
        >
          <div
            class="flex h-16 w-16 items-center justify-center rounded-full border border-gray-400"
          >
            <img
              class="h-16 w-16 rounded-full"
              src="../assets/images/profile-bot.avif"
            />
          </div>
        </div>
      </div>
      <div class="timer mt-2" [class.showTimer]="callStatus == 'started'">
        <div *ngIf="callStatus == 'started'">{{ getFormattedTime() }}</div>
      </div>

      <div class="timer mt-2" [class.showTimer]="callStatus == 'ended'">
        <div *ngIf="callStatus == 'ended'">
          Call Ended: {{ getFormattedTime() }}
        </div>
      </div>
      <div
        class="mt-3 flex w-full items-center justify-evenly"
        *ngIf="callStatus != 'ended'"
      >
        <div class="phone-icon cursor-pointer" (click)="clearTimer()">
          <icon-phone-call-cancel class="h-9 w-9" [fillColor]="'red'" />
        </div>
        <icon-phone-mute
          *ngIf="callStatus != 'started'"
          class="h-6 w-6"
          [fill]="true"
        />
        <div class="phone-icon cursor-pointer" *ngIf="callStatus != 'started'">
          <icon-phone-call
            class="phone-icon h-8 w-8 text-green-500"
            [fill]="true"
          />
        </div>
      </div>
    </div>
    <div
      class="panel flex basis-1/3 flex-col items-center justify-center gap-1 rounded-3xl"
      *ngIf="callStatus != ''"
    >
      <div *ngIf="callStatus == 'outgoing'" class="text-sm text-gray-600">
        Incoming call
      </div>
      <div class="text-center text-lg font-semibold">Ask EVA</div>
      <div
        class="mt-2 flex h-24 w-24 items-center justify-center rounded-full border border-gray-100"
      >
        <div
          class="flex h-20 w-20 items-center justify-center rounded-full border border-gray-200"
        >
          <div
            class="flex h-16 w-16 items-center justify-center rounded-full border border-gray-400"
          >
            <img
              class="h-16 w-16 rounded-full"
              src="../assets/images/profile-female.png"
            />
          </div>
        </div>
      </div>
      <div class="timer mt-2" [class.showTimer]="callStatus == 'started'">
        <div *ngIf="callStatus == 'started'">{{ getFormattedTime() }}</div>
      </div>

      <div class="timer mt-2" [class.showTimer]="callStatus == 'ended'">
        <div *ngIf="callStatus == 'ended'">
          Call Ended: {{ getFormattedTime() }}
        </div>
      </div>
      <div
        class="mt-3 flex w-full items-center justify-evenly"
        *ngIf="callStatus != 'ended'"
      >
        <div class="phone-icon cursor-pointer" (click)="clearTimer()">
          <icon-phone-call-cancel class="h-9 w-9" [fillColor]="'red'" />
        </div>
        <icon-phone-mute
          *ngIf="callStatus != 'started'"
          class="h-6 w-6"
          [fill]="true"
        />
        <div class="phone-icon cursor-pointer" *ngIf="callStatus != 'started'">
          <icon-phone-call
            class="phone-icon h-8 w-8 text-green-500"
            [fill]="true"
          />
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="callStatus != ''" class="flex justify-between gap-3 pt-5">
    <div class="panel flex flex-1 flex-col p-0">
      <div class="border-b p-3 text-center text-lg font-semibold">
        Call Transcript
      </div>

      <div class="p-3"><strong>User Request:</strong> {{userPrompt}}</div>

      <div class="p-3" *ngIf="callStatus == 'started'">
        <strong>Call established ...</strong>
      </div>
      <div
        class="p-3"
        *ngFor="let message of displayedMessages"
        [ngClass]="message.sender"
      >
        <strong>{{ message.sender }}:</strong> {{ message.displayedText }}
      </div>
    </div>
  </div>
</div>
